name: Merge Queue CLA Bridge

on:
  merge_group:
    types: [checks_requested]

permissions:
  contents: read
  statuses: write

jobs:
  cla-status:
    name: license/cla
    runs-on: ubuntu-latest
    steps:
      - name: Mirror CLA status onto merge queue commit
        uses: actions/github-script@f28e40c7f34bde8b3046d885e986cb6290c5673b # v7
        with:
          script: |
            const sha = context.payload.merge_group?.head_sha || context.sha;
            await github.rest.repos.createCommitStatus({
              owner: context.repo.owner,
              repo: context.repo.repo,
              sha,
              state: "success",
              context: "license/cla",
              description: "CLA is validated on pull_request before queueing.",
              target_url: `${context.serverUrl}/${context.repo.owner}/${context.repo.repo}/pulls`
            });
