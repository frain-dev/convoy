name: Docker Install Smoke Test

on:
  push:
    branches:
      - main
  pull_request:
    paths:
      - "configs/local/**"
      - ".github/workflows/docker-smoke-test.yml"
      - "Dockerfile.dev"
      - "cmd/**"
      - "api/**"

permissions:
  contents: read

jobs:
  smoke-test:
    name: Docker compose smoke test
    runs-on: ubuntu-latest
    steps:
      - name: Check out code
        uses: actions/checkout@93cb6efe18208431cddfb8368fd83d5badbf9bfd # v5

      - name: Build image from PR
        run: docker build -t convoy:smoke-test -f Dockerfile.dev .

      - name: Run smoke test
        run: ./configs/local/smoke-test.sh
        env:
          CONVOY_IMAGE: convoy:smoke-test
