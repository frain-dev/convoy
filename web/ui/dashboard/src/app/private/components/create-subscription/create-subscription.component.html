<form class="padding-bottom__40px" [formGroup]="subscriptonForm" (ngSubmit)="createSubscription()">
	<section class="card padding-all__24px">
		<div class="input">
			<label for="source-name">Subscription name</label>
			<input type="text" id="subscription-name" placeholder="e.g paystack-prod" formControlName="name" />
			<div class="input__error input__error__danger" *ngIf="subscriptonForm.controls['name'].touched && subscriptonForm.controls['name'].invalid">
				<img src="assets/img/input-error-icon.svg" alt="input error icon" />
				<span>Enter new subscription name</span>
			</div>
		</div>

		<div class="input margin-bottom__0px">
			<label for="source" class="position__relative">
				Source
				<span class="bg__grey__light rounded__4px padding-x__4px position__absolute position--right__0px font__10px font__weight-400">required</span>
			</label>
			<select id="source" formControlName="source_id">
				<option value="">Select source</option>
				<option [value]="source.uid" *ngFor="let source of sources">{{ source.name }}</option>
			</select>
			<div class="input__error input__error__danger" *ngIf="subscriptonForm.get('source_id')?.touched && subscriptonForm.get('source_id')?.invalid">
				<img src="assets/img/input-error-icon.svg" alt="input error icon" />
				<span>Select or create a source</span>
			</div>
		</div>
		<button class="button button__clear button--has-icon font__12px margin-top__4px margin-bottom__20px" type="button" (click)="showCreateSourceModal = true">
			<svg width="14" height="14" class="margin-right__4px" fill="var(--primary-color)">
				<use xlink:href="#plus-icon"></use>
			</svg>
			New Source
		</button>

		<div class="input margin-bottom__0px">
			<label for="application" class="position__relative">
				Application
				<span class="bg__grey__light rounded__4px padding-x__4px position__absolute position--right__0px font__10px font__weight-400">required</span>
			</label>
			<select id="application" formControlName="app_id" (change)="onUpdateAppSelection()">
				<option value="">Select application</option>
				<option [value]="app.uid" *ngFor="let app of apps">{{ app.name }}</option>
			</select>
			<div class="input__error input__error__danger" *ngIf="subscriptonForm.get('app_id')?.touched && subscriptonForm.get('app_id')?.invalid">
				<img src="assets/img/input-error-icon.svg" alt="input error icon" />
				<span>Select or create an application</span>
			</div>
		</div>
		<button class="button button__clear button--has-icon font__12px margin-top__4px margin-bottom__20px" type="button" (click)="showCreateAppModal = true">
			<svg width="14" height="14" class="margin-right__4px" fill="var(--primary-color)">
				<use xlink:href="#plus-icon"></use>
			</svg>
			New App
		</button>

		<div class="input margin-bottom__0px" [ngClass]="{ disabled: subscriptonForm.get('app_id')?.invalid }">
			<label for="endpoint" class="position__relative">
				Endpoint
				<span class="bg__grey__light rounded__4px padding-x__4px position__absolute position--right__0px font__10px font__weight-400">required</span>
			</label>
			<select id="endpoint" formControlName="endpoint_id">
				<option value="">Select endpoint</option>
				<option [value]="endpoint.uid" *ngFor="let endpoint of endPoints">{{ endpoint.target_url }}</option>
			</select>
			<div class="input__error input__error__danger" *ngIf="subscriptonForm.get('endpoint_id')?.touched && subscriptonForm.get('endpoint_id')?.invalid">
				<img src="assets/img/input-error-icon.svg" alt="input error icon" />
				<span>Select an endpoint</span>
			</div>
		</div>
	</section>

	<div class="button-container flex flex__justify-end margin-top__32px">
		<button class="button button__white padding-y__12px padding-x__28px rounded__8px margin-right__16px" type="button">Cancel</button>

		<button class="button button__primary button--has-icon padding-y__12px rounded__8px" type="submit">
			Create Subscription
			<svg width="24" height="24" class="margin-left__8px" fill="#FCFCFC">
				<use xlink:href="#arrow-right-icon"></use>
			</svg>
		</button>
	</div>
</form>

<div class="_overlay" *ngIf="showCreateAppModal || showCreateSourceModal" (click)="showCreateAppModal = !showCreateAppModal; showCreateSourceModal = !showCreateSourceModal"></div>
<div class="modal modal__right large" *ngIf="showCreateAppModal || showCreateSourceModal">
	<!-- add endpoint modal  -->
	<div class="modal--head" *ngIf="showCreateAppModal">
		<h2>Create New App</h2>
		<button (click)="showCreateAppModal = false">
			<img src="/assets/img/modal-close-icon.svg" alt="close icon" />
		</button>
	</div>
	<div class="modal--head" *ngIf="showCreateSourceModal">
		<h2>Create New Source</h2>
		<button (click)="showCreateSourceModal = false">
			<img src="/assets/img/modal-close-icon.svg" alt="close icon" />
		</button>
	</div>

	<div class="modal--body">
		<app-create-app (createApp)="onCreateNewApp($event); showCreateAppModal = false" (discardApp)="showCreateAppModal = false" *ngIf="showCreateAppModal"></app-create-app>
		<app-create-source *ngIf="showCreateSourceModal" (onAction)="$event?.action == 'close' ? false : onCreateSource($event); showCreateSourceModal = false"></app-create-source>
	</div>
</div>
