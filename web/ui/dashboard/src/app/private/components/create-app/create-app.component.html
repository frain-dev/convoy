<div class="modal--head">
    <h2>{{ editAppMode ? 'Edit App' : 'Create App' }}</h2>
    <a (click)="closeCreateAppInstance(); editAppMode = false; addNewAppForm.reset()">
        <img src="/assets/img/modal-close-icon.svg" alt="close icon" />
    </a>
</div>

<div class="modal--body">
    <form [formGroup]="addNewAppForm" id="create-app-form">
        <div class="grid grid__col-2 grid--gap__20px">
            <div class="input">
                <label for="app-name">Enter App Name</label>
                <input id="app-name" type="text" formControlName="name" [ngClass]="{ danger: addNewAppForm.controls.name.touched && addNewAppForm.controls.name.invalid }" />
                <div class="input__error input__error__danger" *ngIf="addNewAppForm.controls.name.touched && addNewAppForm.controls.name.invalid">
                    <img src="assets/img/input-error-icon.svg" alt="input error icon" />
                    <span>App name is required</span>
                </div>
            </div>

            <div class="input">
                <label class="flex flex__align-items-center" for="app-email">
                    Support Email
                    <app-tooltip [size]="'small'" class="margin-left__4px">We use this to send an email notifcation for when a failure happens</app-tooltip>
                </label>
                <input type="text" id="app-email" formControlName="support_email" />
            </div>
        </div>
        <div class="grid grid__col-2 grid--gap__20px">
            <div class="input">
                <label for="app-secret">Secret</label>
                <input id="app-secret" type="text" formControlName="secret" [ngClass]="{ danger: addNewAppForm.controls.secret.touched && addNewAppForm.controls.secret.invalid }" />
                <div class="input__error input__error__danger" *ngIf="addNewAppForm.controls.secret.touched && addNewAppForm.controls.secret.invalid">
                    <img src="assets/img/input-error-icon.svg" alt="input error icon" />
                    <span>App name is required</span>
                </div>
            </div>

            <div class="input">
                <label for="app-description">
                    Description
                </label>
                <input type="text" id="app-description" formControlName="description" />
            </div>
        </div>

        <div class="grid grid__col-2 grid--gap__20px">
            <div class="input">
                <label for="app-config">Rate limit config</label>
                <input id="app-config" type="text" formControlName="config" [ngClass]="{ danger: addNewAppForm.controls.config.touched && addNewAppForm.controls.config.invalid }" />
                <div class="input__error input__error__danger" *ngIf="addNewAppForm.controls.config.touched && addNewAppForm.controls.config.invalid">
                    <img src="assets/img/input-error-icon.svg" alt="input error icon" />
                    <span>App name is required</span>
                </div>
            </div>
        </div>
        <div *ngIf="!editAppMode" formArrayName="endpoints">
            <div *ngIf="endpoints.controls.length > 0" class="flex flex__align-items-center flex__justify-between">
                <h3>Endpoint</h3>
                <button (click)="addEndpoint()" class="button__clear button--has-icon icon-left">
                    <img src="/assets/img/add-icon.svg" alt="close icon" />
                    Add Endpoint
                </button>
            </div>

            <div *ngFor="let endpoint of endpoints.controls; let i = index">
                <div [formGroupName]="i">
                    <div class="input">
                        <input type="text" formControlName="description" required />
                        <label for="">Description</label>
                        <div class="input__error input__error__danger" *ngIf="getSingleEndpoint(i).description.touched && getSingleEndpoint(i).description.invalid">
                            <img src="assets/img/input-error-icon.svg" alt="input error icon" />
                            <span>Please provide a description</span>
                        </div>
                    </div>

                    <div class="input">
                        <input type="text" formControlName="url" required />
                        <label for="">Enter Endpoint URL</label>
                        <div class="input__error input__error__danger" *ngIf="getSingleEndpoint(i).url.touched && getSingleEndpoint(i).url.invalid">
                            <img src="assets/img/input-error-icon.svg" alt="input error icon" />
                            <span>Please provide a description</span>
                        </div>
                    </div>

                    <div class="input multiple">
                        <div class="input--multiple" [ngClass]="{ active: eventTags.length > 0 }">
                            <div class="tag" *ngFor="let tag of eventTags">
                                {{ tag }}
                                <a (click)="removeEventTag(tag)">
                                    <img src="/assets/img/close-icon-black.svg" alt="close icon" />
                                </a>
                            </div>
                            <input type="text" id="tagInput" formControlName="tag" (input)="addTag()" required />
                        </div>

                        <label [ngClass]="{ active: eventTags.length > 0 }" for="">Add Tag</label>
                        <div class="input__error input__error__secondary font__12px">
                            <img src="/assets/img/small-info-icon.svg" alt="close icon" />
                            Add multiple tags by seperating them with commas
                        </div>

                        <div class="input__error input__error__danger" *ngIf="getSingleEndpoint(i).tag.touched && getSingleEndpoint(i).tag.invalid">
                            <img src="assets/img/input-error-icon.svg" alt="input error icon" />
                            <span>Please add at least one tag</span>
                        </div>
                    </div>

                    <div class="flex flex__justify-end margin-bottom__16px">
                        <button (click)="removeEndpoint(i)" class="button__clear color__danger button--has-icon icon-left">
                            <img src="/assets/img/trash-icon.svg" alt="close icon" />
                            Remove Endpoint
                        </button>
                    </div>
                </div>
            </div>
            <!-- to be reviewed -->
            <!-- <div class="flex flex__justify-end" >
                <button *ngIf="endpoints.controls.length == 0" (click)="addEndpoint()" class="button__clear button--has-icon icon-left margin-top__20px">
                    <img src="/assets/img/add-icon.svg" alt="close icon" />
                    Add Endpoint
                </button>
            </div> -->
        </div>
    </form>
    <div class="flex flex__justify-end padding-all__24px">
        <button class="button button__white button--large" (click)="closeCreateAppInstance(); editAppMode = false; addNewAppForm.reset()">Discard</button>
        <button id="create-app-button" class="button button__primary margin-left__24px" [disabled]="isCreatingNewApp" (click)="createNewApp()">
            {{ editAppMode ? 'Edit App' : 'Create App' }}
        </button>
    </div>
</div>