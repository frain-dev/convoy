<form [formGroup]="addNewAppForm" id="create-app-form" class="card padding-all__24px">
	<div class="grid grid__col-2 grid--gap__20px">
		<div class="input">
			<label for="app-name">Enter App Name</label>
			<input id="app-name" type="text" formControlName="name" [ngClass]="{ danger: addNewAppForm.controls.name.touched && addNewAppForm.controls.name.invalid }" />
			<div class="input__error input__error__danger" *ngIf="addNewAppForm.controls.name.touched && addNewAppForm.controls.name.invalid">
				<img src="assets/img/input-error-icon.svg" alt="input error icon" />
				<span>App name is required</span>
			</div>
		</div>

		<div class="input">
			<label for="app-description">Description</label>
			<input type="text" id="app-description" formControlName="description" />
		</div>
	</div>
	<div class="grid grid__col-2 grid--gap__20px">
		<div class="input">
			<label class="flex flex__align-items-center" for="app-email">
				Support Email
				<app-tooltip [size]="'small'" class="margin-left__4px">We use this to send an email notifcation for when a failure happens</app-tooltip>
			</label>
			<input type="text" id="app-email" formControlName="support_email" />
		</div>
		<div class="input">
			<label class="flex flex__align-items-center" for="app-slack-url">
				Slack webhook url
				<app-tooltip [size]="'small'" class="margin-left__4px">We use this to send an email notifcation for when a failure happens</app-tooltip>
			</label>
			<input id="app-slack-url" type="text" formControlName="slack_webhook_url" />
		</div>
	</div>
	<h2 class="margin-bottom__16px">Is app enabled?</h2>

	<div class="grid grid__col-2 grid--gap__20px">
		<div class="checkbox-option">
			<input type="radio" id="enabled" formControlName="is_disabled" [value]="false" [checked]="addNewAppForm.value.is_disabled" />
			<label for="enabled" class="border__all padding-all__16px rounded__4px position__relative display__block animate">
				<div class="flex flex__align-items-center flex__justify-between position__relative">
					<div class="flex flex__align-items-center">
						<div class="checkbox rounded__50px margin-bottom__0px border__all width__16px height__16px animate"></div>
						<p class="font__14px font__weight-600 margin-left__8px">Yes</p>
					</div>
				</div>
			</label>
		</div>
		<div class="checkbox-option">
			<input type="radio" id="disabled" formControlName="is_disabled" [value]="true" [checked]="addNewAppForm.value.is_disabled" />
			<label for="disabled" class="border__all padding-all__16px rounded__4px position__relative display__block animate">
				<div class="flex flex__align-items-center flex__justify-between position__relative">
					<div class="flex flex__align-items-center">
						<div class="checkbox rounded__50px margin-bottom__0px border__all width__16px height__16px animate"></div>
						<p class="font__14px font__weight-600 margin-left__8px">No</p>
					</div>
				</div>
			</label>
		</div>
	</div>
	<div *ngIf="!editAppMode" formArrayName="endpoints">
		<div *ngIf="endpoints.controls.length > 0" class="flex flex__align-items-center flex__justify-between">
			<h3>Endpoint</h3>
			<button (click)="addEndpoint()" class="button__clear button--has-icon icon-left">
				<img src="/assets/img/add-icon.svg" alt="close icon" />
				Add Endpoint
			</button>
		</div>

		<div *ngFor="let endpoint of endpoints.controls; let i = index">
			<div [formGroupName]="i">
				<div class="input">
					<input type="text" formControlName="description" required />
					<label for="">Description</label>
					<div class="input__error input__error__danger" *ngIf="getSingleEndpoint(i).description.touched && getSingleEndpoint(i).description.invalid">
						<img src="assets/img/input-error-icon.svg" alt="input error icon" />
						<span>Please provide a description</span>
					</div>
				</div>

				<div class="input">
					<input type="text" formControlName="url" required />
					<label for="">Enter Endpoint URL</label>
					<div class="input__error input__error__danger" *ngIf="getSingleEndpoint(i).url.touched && getSingleEndpoint(i).url.invalid">
						<img src="assets/img/input-error-icon.svg" alt="input error icon" />
						<span>Please provide a description</span>
					</div>
				</div>

				<div class="input multiple">
					<div class="input--multiple" [ngClass]="{ active: eventTags.length > 0 }">
						<div class="tag" *ngFor="let tag of eventTags">
							{{ tag }}
							<a (click)="removeEventTag(tag)">
								<img src="/assets/img/close-icon-black.svg" alt="close icon" />
							</a>
						</div>
						<input type="text" id="tagInput" formControlName="tag" (input)="addTag()" required />
					</div>

					<label [ngClass]="{ active: eventTags.length > 0 }" for="">Add Tag</label>
					<div class="input__error input__error__secondary font__12px">
						<img src="/assets/img/small-info-icon.svg" alt="close icon" />
						Add multiple tags by seperating them with commas
					</div>

					<div class="input__error input__error__danger" *ngIf="getSingleEndpoint(i).tag.touched && getSingleEndpoint(i).tag.invalid">
						<img src="assets/img/input-error-icon.svg" alt="input error icon" />
						<span>Please add at least one tag</span>
					</div>
				</div>

				<div class="flex flex__justify-end margin-bottom__16px">
					<button (click)="removeEndpoint(i)" class="button__clear color__danger button--has-icon icon-left">
						<img src="/assets/img/trash-icon.svg" alt="close icon" />
						Remove Endpoint
					</button>
				</div>
			</div>
		</div>
		<!-- to be reviewed -->
		<!-- <div class="flex flex__justify-end" >
            <button *ngIf="endpoints.controls.length == 0" (click)="addEndpoint()" class="button__clear button--has-icon icon-left margin-top__20px">
                <img src="/assets/img/add-icon.svg" alt="close icon" />
                Add Endpoint
            </button>
        </div> -->
	</div>
</form>
<div class="flex flex__justify-end padding-all__24px">
	<button class="button button__white button--large" (click)="closeCreateAppInstance(); editAppMode = false; addNewAppForm.reset()">Discard</button>
	<button id="create-app-button" class="button button__primary margin-left__24px" [disabled]="isSavingApp" (click)="saveApp()">
		{{ editAppMode ? 'Edit App' : 'Create App' }}
	</button>
</div>
