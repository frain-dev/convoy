<div class="padding-x__16px padding-y__24px border__bottom">
	<div class="flex flex__align-items-center flex__justify-between">
		<div class="flex">
			<form class="input__search margin-bottom__0px events-search">
				<img src="/assets/img/search-icon.svg" alt="search icon" />
				<input
					type="search"
					placeholder="Search events"
					[(ngModel)]="eventsSearchString"
					(change)="eventsPage = 1; getEvents({ addToURL: true, fromFilter: true })"
					[ngModelOptions]="{ standalone: true }"
				/>
				<button [class]="'enter-button' + (eventsSearchString && eventsSearchString.length > 0 ? ' show' : '')" (click)="eventsPage = 1; getEvents({ addToURL: true, fromFilter: true })">
					<img src="/assets/img/enter-icon.png" alt="enter icon" />
				</button>
			</form>

			<div class="dropdown margin-left__24px">
				<button
					class="button button__filter without-margin button--has-icon icon-left icon-right"
					[ngClass]="{ active: (eventsFilterDateRange.value.startDate !== '' && eventsFilterDateRange.value.endDate !== '') || selectedEventsDateOption }"
					(click)="showEventFilterCalendar = !showEventFilterCalendar; showOverlay = true"
				>
					<img class="margin-left__0px" src="/assets/img/calendar-icon.svg" alt="calender icon" />
					<span class="margin-right__4px color__primary font__weight-500" *ngIf="eventsFilterDateRange.value.startDate === '' && eventsFilterDateRange.value.endDate === ''">All Time</span>
					<mat-date-range-input [formGroup]="eventsFilterDateRange" [rangePicker]="eventsFilterPicker">
						<input matStartDate formControlName="startDate" />
						<input
							matEndDate
							formControlName="endDate"
							(dateChange)="
								selectedEventsDateOption = formatDate(eventsFilterDateRange.value.startDate) + ' - ' + formatDate(eventsFilterDateRange.value.endDate);
								getEvents({ addToURL: true, fromFilter: true })
							"
						/>
					</mat-date-range-input>
					<mat-date-range-picker #eventsFilterPicker [disabled]="false"></mat-date-range-picker>
					<img class="margin-right__0px" src="assets/img/angle-arrow-down.svg" alt="arrow down icon" />
				</button>

				<div [ngClass]="{ show: showEventFilterCalendar }" class="dropdown__menu large">
					<ul>
						<li
							[ngClass]="{ active: selectedEventsDateOption == dateOption }"
							*ngFor="let dateOption of dateOptions"
							(click)="getSelectedDate(dateOption); showEventFilterCalendar = false; showOverlay = false"
						>
							From {{ dateOption }}
						</li>
						<li (click)="eventsFilterPicker.open(); showEventFilterCalendar = false; showOverlay = false">Custom Option</li>
					</ul>
				</div>
			</div>

			<app-time-filter (applyFilter)="eventsTimeFilterData = $event; getEvents({ addToURL: true, fromFilter: true })" #eventsTimeFilter></app-time-filter>

			<div class="dropdown margin-left__24px">
				<button class="button button__filter button--has-icon icon-left" [ngClass]="{ active: !!eventApp }" (click)="showOverlay = true; showEventsAppsDropdown = !showEventsAppsDropdown">
					<img src="/assets/img/apps-icon-grey.svg" alt="apps filter icon" />
					<span>All Apps</span>
					<img class="margin-left__30px margin-right__0px" src="/assets/img/angle-arrow-down.svg" alt="arrow down icon" />
				</button>

				<div class="dropdown__menu with-padding large" [ngClass]="{ show: showEventsAppsDropdown }">
					<div class="input__search">
						<img src="/assets/img/search-icon.svg" alt="search icon" />
						<input type="search" placeholder="Search apps here" #eventsAppsFilter />
					</div>

					<li class="dropdown__menu__item border__bottom" *ngFor="let app of eventsAppsFilter$ | async">
						<label [for]="app.uid">{{ app.name }}</label>
						<input type="checkbox" name="app" [value]="app.uid" [id]="app.uid" [checked]="app.uid === eventApp" (change)="updateAppFilter(app.uid, $event)" />
					</li>

					<div *ngIf="filteredApps?.length !== 0 && !!eventApp" class="margin-top__10px">
						<button class="button button__clear button__small" (click)="clearEventFilters(); showEventsAppsDropdown = false">Clear</button>
					</div>

					<p *ngIf="filteredApps?.length === 0">No app to display</p>
				</div>
			</div>
		</div>

		<button
			class="button button__white button__small margin-right__20px"
			(click)="clearEventFilters(); selectedEventsDateOption = ''"
			[disabled]="
				(eventsFilterDateRange.value.startDate == '' || eventsFilterDateRange.value.endDate == '') &&
				eventApp == '' &&
				eventsSearchString.length == 0 &&
				eventsTimeFilterData.startTime == 'T00:00:00' &&
				eventsTimeFilterData.endTime == 'T23:59:59'
			"
		>
			Clear Filter
		</button>
	</div>
</div>

<div class="flex">
	<div class="event__table">
		<div class="table table--container has-loader" id="events-table-container">
			<table id="table">
				<thead>
					<tr class="table--head">
						<th *ngFor="let head of eventsTableHead" scope="col">{{ head }}</th>
					</tr>
				</thead>
				<tbody>
					<ng-container *ngFor="let eventGroup of displayedEvents; let i = index">
						<tr class="table--date-row">
							<td>
								<div>{{ eventGroup.date }}</div>
							</td>
							<td></td>
							<td></td>
							<td></td>
						</tr>
						<tr
							*ngFor="let event of eventGroup.content; let index = index"
							[ngClass]="{ active: event.uid === eventsDetailsItem?.uid, 'last-item': index === eventGroup.content.length - 1 }"
							[id]="'event' + i"
							(click)="eventsDetailsItem = event; getEventDeliveriesForSidebar(event.uid)"
						>
							<td>
								<div>
									<div class="tag tag--Neutral">{{ event.event_type }}</div>
								</div>
							</td>
							<td>
								<div class="long-text long-text__150px">
									<span class="underline color__primary">{{ event.app_metadata.title }}</span>
								</div>
							</td>
							<td>
								<div>{{ event.created_at | date: 'mediumTime' }}</div>
							</td>
							<td>
								<div>
									<button class="button__clear button--has-icon icon-right" (click)="eventDeliveryFilteredByEventId = event.uid">
										Deliveries
										<img src="assets/img/angle-arrow-right-primary.svg" alt="arrow right" />
									</button>
								</div>
							</td>
						</tr>
					</ng-container>
				</tbody>
			</table>
		</div>
	</div>
	<div class="event__details">
		<div class="padding-all__16px">
			<ng-container>
				<h3>Details</h3>
				<div class="dashboard--logs--details--req-res">
					<div class="dashboard--logs--details--tabs-data show">
						<h4>Event</h4>
						<prism language="json" [code]="getCodeSnippetString()"></prism>
					</div>
				</div>
			
				<h4 *ngIf="sidebarEventDeliveries && sidebarEventDeliveries.length > 0">Deliveries Overview</h4>
				<ul *ngIf="sidebarEventDeliveries && sidebarEventDeliveries.length > 0">
					<li class="flex flex__align-items-center margin-top__16px border__bottom padding-bottom__10px" *ngFor="let delivery of sidebarEventDeliveries">
						<div [class]="'margin-top__4px tag tag--' + delivery.status">{{ delivery.status }}</div>
						<div class="font__14px color__black margin-left__16px long-text long-text__300px" [title]="delivery.endpoint.target_url">
							{{ delivery.endpoint.target_url }}
						</div>
					</li>
				</ul>
			</ng-container>
		</div>
	</div>
</div>
