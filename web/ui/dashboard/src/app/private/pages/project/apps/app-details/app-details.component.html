<h1 class="font__12px font__weight-500 flex flex__align-items-center margin-bottom__24px text__uppercase">
	<a routerLink="/projects" class="font__weight-500 pointer-cursor">Projects</a>
	<svg width="16" height="16" class="margin-x__4px">
		<use xlink:href="#arrow-right-icon"></use>
	</svg>
	{{ privateService.activeProjectDetails?.name }}
	<svg width="16" height="16" class="margin-x__4px">
		<use xlink:href="#arrow-right-icon"></use>
	</svg>
	<a class="pointer-cursor font__weight-500" (click)="goBack()">Apps</a>
	<svg width="16" height="16" class="margin-x__4px">
		<use xlink:href="#arrow-right-icon"></use>
	</svg>
	<span class="font__weight-500 color__primary">{{ appsDetailsItem?.name || 'App' }}</span>
</h1>

<div class="card padding-all__32px margin-bottom__20px">
	<div class="flex flex__justify-between flex__align-items-center margin-bottom__24px">
		<h3>Overview</h3>
		<button class="button button__white button__small" [disabled]="appsDetailsItem?.events === 0" (click)="loadEventsFromAppsTable(appsDetailsItem.uid)">View Event</button>
	</div>
	<div class="flex flex__align-items-center flex__wrap flex__justify-between margin-bottom__32px">
		<div>
			<p class="color__grey font__12px font__weight-300">DATE CREATED</p>
			<p class="color__black font__14px font__weight-500">{{ appsDetailsItem?.created_at | date: 'mediumDate' }}</p>
		</div>
		<div>
			<p class="color__grey font__12px font__weight-300">SUPPORT EMAIL</p>
			<p class="color__black font__14px font__weight-500">{{ appsDetailsItem?.support_email || '...no support email provided' }}</p>
		</div>
		<div>
			<p class="color__grey font__12px font__weight-300">UPDATED</p>
			<p class="color__black font__14px font__weight-500">{{ appsDetailsItem?.updated_at | date: 'mediumDate' }}</p>
		</div>
		<div>
			<p class="color__grey font__12px font__weight-300">EVENTS</p>
			<p class="color__black font__14px font__weight-500">{{ appsDetailsItem?.events }}</p>
		</div>
		<div>
			<p class="color__grey font__12px font__weight-300">ENDPOINTS</p>
			<p class="color__black font__14px font__weight-500">{{ appsDetailsItem?.endpoints?.length }}</p>
		</div>
	</div>
	<!-- pending when backend is ready  -->
	<!-- <div>
        <p class="flex flex__align-items-center font__14px font__weight-500 margin-bottom__8px">
            Enable Notification
            <img src="/assets/img/primary-info-icon.svg" class="margin-left__10px" alt="info icon" />
        </p>
        <label class="toggle">
            <input class="toggle-checkbox" type="checkbox" (change)="editAppStatus(appsDetailsItem)" [checked]="!appsDetailsItem?.is_disabled" />
            <div class="toggle-switch"></div>
        </label>
    </div> -->
	<div class="flex flex__justify-between flex__wrap border__top margin-top__22px">
		<div class="padding-top__32px" [ngClass]="{ 'width__50 border__right padding-right__32px': !shouldRenderSmallSize, width__100: shouldRenderSmallSize }">
			<div class="flex flex__align-items-center flex__justify-between">
				<h3>App Event Endpoints</h3>
				<div class="flex flex__align-items-center">
					<button class="button__clear font__12px" (click)="showAddEndpointModal = !showAddEndpointModal">Add Endpoints</button>
					<div class="line margin-right__16px margin-left__16px border__left"></div>
					<button class="button__clear font__12px" [disabled]="appsDetailsItem && appsDetailsItem?.endpoints?.length == 0" (click)="setEventAppId()">Send Event</button>
				</div>
			</div>
			<ul class="margin-top__20px">
				<ng-container *ngIf="appsDetailsItem?.endpoints">
					<li class="app-details bg__grey-fade padding-all__16px rounded__8px margin-bottom__24px" *ngFor="let endpoint of appsDetailsItem.endpoints">
						<div>
							<div class="flex flex__align-items-center">
								<h5 class="color__black font__14px font__weight-400">{{ endpoint.description }}</h5>
								<button
									class="margin-left__16px margin-top__2px button__clear font__12px color__primary button--has-icon icon-right smaller-icon"
									(click)="viewEndpointSecretKey(endpoint.secret)"
								>
									View Secret
									<img src="/assets/img/arrow-up-right.svg" alt="link out" class="margin-left__6px" />
								</button>
							</div>
							<p class="flex flex__align-items-center font__14px color__black font__weight-300 margin-top__16px">
								<img src="/assets/img/link-icon.svg" alt="link icon" class="margin-right__8px" />
								{{ endpoint.target_url }}
							</p>
							<div class="flex margin-top__16px">
								<div class="tag tag__events" *ngFor="let event of endpoint?.events">{{ event == '*' ? 'all events' : event }}</div>
							</div>
						</div>
						<div class="app-details--inactive flex flex__align-items-center flex__column flex__justify-center padding-all__24px" *ngIf="endpoint.status == 'inactive'">
							<div class="icon flex flex__align-items-center flex__justify-center margin-bottom__8px padding-all__10px">
								<img src="/assets/img/lock.svg" alt="lock icon" />
							</div>
							<p class="color__dark font__16px font__weight-600">Endpoint Disabled</p>
							<!-- pending till this is figured out by backend -->
							<!-- <a class="color__primary font__14px font__weight-500 margin-bottom__10px">Click here to learn how to enable this endpoint</a> -->
						</div>
					</li>
				</ng-container>
			</ul>
			<div class="empty-state smaller-table" *ngIf="appsDetailsItem?.endpoints?.length === 0">
				<img src="/assets/img/empty-state-img.svg" alt="empty state" />
				<p>No endpoint has been added for selected app yet</p>
			</div>
		</div>
		<div class="padding-top__32px" [ngClass]="{ 'width__50 padding-left__32px': !shouldRenderSmallSize, 'border__top width__100': shouldRenderSmallSize }">
			<div>
				<h3>App Portal</h3>
				<ul class="margin-top__10px">
					<li class="list-item__inline">
						<div class="list-item__inline--label">App Page</div>
						<div class="list-item__inline--item link" (click)="getAppPortalToken({ redirect: true })">
							Open Link
							<img src="/assets/img/arrow-up-right.svg" alt="link out" />
						</div>
					</li>
					<li class="list-item__inline">
						<div class="list-item__inline--label">Embed into your platform</div>
						<a class="list-item__inline--item link" href="https://getconvoy.io/docs/app-portal" target="_blank">
							See Documentation
							<img src="/assets/img/arrow-up-right.svg" alt="link out" />
						</a>
					</li>
					<li class="list-item__inline">
						<div class="list-item__inline--label">Embed Iframe portal</div>
						<div class="list-item__inline--item"></div>
					</li>
					<div class="bg__white-100 border__all__2 rounded__10px padding-all__16px margin-top__16px">
						<div class="text font__14px color__grey overflow--scroll__x">{{ appPortalLink }}</div>
						<div class="flex flex__justify-end">
							<button class="button__clear button--has-icon icon-left" (click)="copyKey(appPortalLink, 'secret')">
								<img src="/assets/img/copy.svg" alt="copy" />
								<small *ngIf="showSecretCopyText">Copied!</small>
							</button>
						</div>
					</div>
				</ul>
			</div>
		</div>
	</div>
</div>

<!-- dark overlay  -->
<div class="_overlay" *ngIf="showAddEndpointModal || showAddEventModal || showEndpointSecret" (click)="showAddEndpointModal = false; showAddEventModal = false; showEndpointSecret = false"></div>

<!-- create app, add new endpoint, add event modals  -->
<div class="modal modal__right" *ngIf="showAddEndpointModal || showAddEventModal || showEndpointSecret">
	<!-- add endpoint modal  -->
	<div class="modal--head" *ngIf="showAddEndpointModal">
		<h2>Add Endpoint</h2>
		<a (click)="showAddEndpointModal = false">
			<img src="/assets/img/modal-close-icon.svg" alt="close icon" />
		</a>
	</div>

	<div class="modal--body" *ngIf="showAddEndpointModal">
		<form [formGroup]="addNewEndpointForm">
			<div class="input">
				<label class="flex flex__justify-between" for="description">
					Description
					<span class="bg__grey__light rounded__4px padding-x__4px position__absolute position--right__0px font__10px font__weight-400">required</span>
				</label>
				<input
					id="description"
					type="text"
					formControlName="description"
					[ngClass]="{ danger: addNewEndpointForm.controls.description.touched && addNewEndpointForm.controls.description.invalid }"
					required
				/>
				<div class="input__error input__error__danger" *ngIf="addNewEndpointForm.controls.description.touched && addNewEndpointForm.controls.description.invalid">
					<img src="assets/img/input-error-icon.svg" alt="input error icon" />
					<span>Please provide a description</span>
				</div>
			</div>

			<div class="input">
				<label class="flex flex__justify-between" for="endpoint-url">
					Enter URL
					<span class="bg__grey__light rounded__4px padding-x__4px position__absolute position--right__0px font__10px font__weight-400">required</span>
				</label>
				<input id="endpoint-url" type="text" formControlName="url" [ngClass]="{ danger: addNewEndpointForm.controls.url.touched && addNewEndpointForm.controls.url.invalid }" required />
				<div class="input__error input__error__danger" *ngIf="addNewEndpointForm.controls.url.touched && addNewEndpointForm.controls.url.invalid">
					<img src="assets/img/input-error-icon.svg" alt="input error icon" />
					<span>Endpoint URL is required</span>
				</div>
			</div>

			<div class="input multiple">
				<label class="flex flex__justify-between" for="tagInput">
					<div class="flex flex__align-items-center">
						Events
						<app-tooltip [size]="'small'" position="right" class="margin-left__4px">Add multiple events by separating them with commas.</app-tooltip>
					</div>
					<span class="bg__grey__light rounded__4px padding-x__4px position__absolute position--right__0px font__10px font__weight-400">required</span>
				</label>
				<div class="input--multiple" (click)="focusInput()">
					<div class="tag" *ngFor="let tag of eventTags">
						{{ tag }}
						<a (click)="removeEventTag(tag)">
							<img src="/assets/img/close-icon-black.svg" alt="close icon" />
						</a>
					</div>
					<input type="text" id="tagInput" (input)="addTag()" required />
				</div>
			</div>
		</form>
	</div>

	<div class="modal--footer modal--footer__with-shadow" *ngIf="showAddEndpointModal">
		<button class="button button__white margin-right__24px" (click)="showAddEndpointModal = false">Discard</button>
		<button class="button button__primary button--full-100" [disabled]="isCreatingNewEndpoint" (click)="addNewEndpoint()">{{ isCreatingNewEndpoint ? 'Adding Endpoint..' : 'Add Endpoint' }}</button>
	</div>

	<!-- add event modal  -->
	<div class="modal--head" *ngIf="showAddEventModal">
		<h2>Add Event</h2>
		<a (click)="showAddEventModal = false">
			<img src="/assets/img/modal-close-icon.svg" alt="close icon" />
		</a>
	</div>

	<div class="modal--body" *ngIf="showAddEventModal">
		<form [formGroup]="sendEventForm">
			<div class="input">
				<label class="flex flex__align-items-center" for="appId">
					App ID
					<span class="bg__grey__light rounded__4px padding-x__4px position__absolute position--right__0px font__10px font__weight-400">required</span>
				</label>
				<select id="appId" class="editMode" formControlName="app_id">
					<option *ngFor="let app of apps?.content" [value]="app.uid">{{ app.name }}</option>
				</select>
				<div class="input__error input__error__danger" *ngIf="sendEventForm.controls.app_id.touched && sendEventForm.controls.app_id.invalid">
					<img src="assets/img/input-error-icon.svg" alt="input error icon" />
					<span>App Id is required</span>
				</div>
			</div>
			<div class="input">
				<label class="flex flex__justify-between" for="data">
					<div class="flex flex__align-items-center">
						Data
						<app-tooltip [size]="'small'" position="right" class="margin-left__4px">Please enter your data in the format it would be returned.</app-tooltip>
					</div>

					<span class="bg__grey__light rounded__4px padding-x__4px position__absolute position--right__0px font__10px font__weight-400">required</span>
				</label>
				<textarea id="data" formControlName="data" required cols="5" [ngClass]="{ danger: sendEventForm.controls.data.touched && sendEventForm.controls.data.invalid }"></textarea>
				<div class="input__error input__error__danger" *ngIf="sendEventForm.controls.data.touched && sendEventForm.controls.data.invalid">
					<img src="assets/img/input-error-icon.svg" alt="input error icon" />
					<span>Data is required</span>
				</div>
			</div>
			<div class="input">
				<label class="flex flex__justify-between" for="eventType">
					Event Type
					<span class="bg__grey__light rounded__4px padding-x__4px position__absolute position--right__0px font__10px font__weight-400">required</span>
				</label>
				<input id="eventType" type="text" formControlName="event_type" [ngClass]="{ danger: sendEventForm.controls.event_type.touched && sendEventForm.controls.event_type.invalid }" required />
				<div class="input__error input__error__danger" *ngIf="sendEventForm.controls.event_type.touched && sendEventForm.controls.event_type.invalid">
					<img src="assets/img/input-error-icon.svg" alt="input error icon" />
					<span>Event type is required</span>
				</div>
			</div>
		</form>
	</div>
	<div class="modal--footer modal--footer__with-shadow" *ngIf="showAddEventModal">
		<button class="button button__white margin-right__24px" (click)="showAddEventModal = false">Discard</button>
		<button class="button button__primary button--full-100" [disabled]="isSendingNewEvent" (click)="sendNewEvent()">{{ isSendingNewEvent ? 'Adding Event..' : 'Add Event' }}</button>
	</div>

	<!-- endpoint secret modal  -->
	<div class="modal--head" *ngIf="showEndpointSecret">
		<h2>Endpoint Secret</h2>
		<a (click)="showEndpointSecret = false">
			<img src="/assets/img/modal-close-icon.svg" alt="close icon" />
		</a>
	</div>
	<div class="modal--body" *ngIf="showEndpointSecret">
		<div class="key">
			<span>{{ endpointSecretKey }}</span>
			<button (click)="copyKey(endpointSecretKey, 'secret')">
				<img src="/assets/img/copy.svg" alt="copy" />
				<small *ngIf="showSecretCopyText">Copied!</small>
			</button>
		</div>
	</div>
</div>
