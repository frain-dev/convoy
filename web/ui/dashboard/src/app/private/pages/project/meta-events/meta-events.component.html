<div class="text-12 font-medium flex items-center uppercase mb-24px">
	<a routerLink="/projects" class="font-medium cursor-pointer">Projects</a>
	<svg width="16" height="16" class="mx-4px">
		<use xlink:href="#arrow-right-icon"></use>
	</svg>
	{{ privateService.activeProjectDetails?.name }}
	<svg width="16" height="16" class="mx-4px">
		<use xlink:href="#arrow-right-icon"></use>
	</svg>
	<span class="text-primary-100 font-medium">Meta Events</span>
</div>

<!-- header  -->
<div class="flex justify-between items-end border-b border-b-grey-10 pb-20px mb-24px">
	<div class="flex items-center">
		<h1 class="text-24 font-bold text-grey-80 mr-10px">Meta Events</h1>
		<convoy-tooltip position="right">Meta events are operation events that occur on your project, such as: event delivery, endpoints status, e.t.c. You can receive this events notification via HTTPS or Pub/Sub.</convoy-tooltip>
	</div>
</div>

<div convoy-card class="flex" *ngIf="isMetaEventEnabled">
	<div class="min-w-[605px] w-full h-full overflow-hidden relative">
		<convoy-table-loader id="meta_events_loader" [tableHead]="metaEventsTableHead" *ngIf="isLoadingMetaEvents"></convoy-table-loader>

		<div class="min-h-[70vh] overflow-y-auto overflow-x-auto w-full min-w-[485px]" id="events-table-container" *ngIf="!isLoadingMetaEvents">
			<table convoy-table>
				<thead convoy-table-head>
					<th convoy-table-head-cell [class]="i === 0 ? 'pl-20px' : ''" *ngFor="let head of metaEventsTableHead; let i = index">{{ head }}</th>
				</thead>
				<tbody>
					<ng-container *ngFor="let eventGroup of displayedMetaEvents; let i = index">
						<tr convoy-table-row [forDate]="true">
							<td convoy-table-cell [forDate]="true">{{ eventGroup.date }}</td>
							<td convoy-table-cell [forDate]="true"></td>
							<td convoy-table-cell [forDate]="true"></td>
						</tr>
						<tr convoy-table-row class="group" *ngFor="let event of eventGroup.content; let index = index" (click)="selectedMetaEvent = event" [active]="selectedMetaEvent?.uid === event.uid">
							<td convoy-table-cell class="w-130px pl-16px pr-30px relative">
								<convoy-tag [type]="event.status | statuscolor">{{ event.status }}</convoy-tag>
							</td>

							<td convoy-table-cell>
								<convoy-tag type="grey">{{ event.event_type }}</convoy-tag>
							</td>

							<td convoy-table-cell class="">{{ event.metadata.num_trials }}</td>
							<td convoy-table-cell class="">{{ event.created_at | date: 'mediumTime' }}</td>
							<td convoy-table-cell class="">
								<button convoy-button size="xs" texture="light" [disabled]="isRetryingMetaEvent" (click)="retryMetaEvent(event.uid)">
									<img src="assets/img/refresh-icon-primary.svg" alt="refresh icon" class="mr-10px" />
									Retry
								</button>
							</td>

							<td convoy-table-cell>
								<button convoy-button fill="clear" size="sm" (click)="selectedMetaEvent = event">
									<img src="assets/img/angle-arrow-right-primary.svg" class="ml-16px h-16px" alt="arrow right" />
								</button>
							</td>
						</tr>
					</ng-container>
				</tbody>
			</table>
		</div>

		<convoy-empty-state type="table" imgSrc="/assets/img/empty-state.svg" className="min-h-[70vh]" description="No event to show here" *ngIf="!isLoadingMetaEvents && (!displayedMetaEvents || displayedMetaEvents?.length === 0)"></convoy-empty-state>
	</div>

	<div class="max-w-[450px] w-full max-h-[calc(100vh - 950px)] min-h-[707px] overflow-auto relative border-l border-grey-10">
		<div class="p-16px">
			<ng-container *ngIf="isLoadingMetaEvents">
				<div class="bg-grey-10 rounded-8px animate-pulse h-150px w-full mr-40px mb-20px"></div>
				<div class="bg-grey-10 rounded-8px animate-pulse h-150px w-full mr-40px"></div>
			</ng-container>

			<ng-container *ngIf="displayedMetaEvents && displayedMetaEvents.length > 0">
				<h3 class="text-16 font-bold mb-16px">Details</h3>
				<prism language="json" [code]="getCodeSnippetString('req_header')" title="Request header"></prism>
				<div class="mb-20px"></div>
				<prism language="json" [code]="getCodeSnippetString('res_header')" title="Response Header"></prism>
				<div class="mb-20px"></div>
				<prism language="json" [code]="getCodeSnippetString('res_body')" title="Response Body"></prism>
			</ng-container>
			<convoy-empty-state type="table" imgSrc="/assets/img/empty-state.svg" className="min-h-[70vh]" description="No event details to show here" *ngIf="!isLoadingMetaEvents && (!displayedMetaEvents || displayedMetaEvents?.length === 0)"></convoy-empty-state>
		</div>
	</div>
</div>

<!-- empty state  -->
<div class="py-100px" convoy-card *ngIf="!isMetaEventEnabled">
	<div
		convoy-empty-state
		imgSrc="/assets/img/events-empty-state-image.svg"
		heading="Turn On Meta Events to Start Seeing Events"
		description="Meta events are operation events that occur on your project, such as: event delivery, endpoints status, e.t.c. You can receive this events notification via HTTPS or Pub/Sub."
		id="meta-events-empty-state"
	></div>
</div>
