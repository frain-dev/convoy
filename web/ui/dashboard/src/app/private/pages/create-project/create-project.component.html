<div class="modal modal__full margin-bottom__40px">
	<div class="modal--head">
		<div class="flex flex__align-items-center flex__justify-between width__100">
			<div class="modal--head--left flex flex__align-items-center">
				<a routerLink="/projects" class="margin-right__16px width__32px height__32px flex flex__align-items-center flex__justify-center rounded__6px button__clear" tabindex="0">
					<img src="/assets/img/modal-close-icon.svg" alt="close icon" />
				</a>
				<h2 class="font__16px font__weight-600">Create Project</h2>
			</div>

			<a class="button--has-icon icon-left" target="_blank" href="https://getconvoy.io/docs" rel="noreferrer">
				<img src="/assets/img/doc-icon-primary.svg" alt="doc icon" />
				<span class="font__weight-500 font__14px color__primary">Go to docs</span>
			</a>
		</div>
	</div>

	<div class="modal--body padding-all__0px">
		<p class="font__14px color__grey margin-bottom__24px">A project represents the top level namespace for grouping event sources, applications, endpoints and events.</p>

		<form [formGroup]="projectForm" *ngIf="projectStage === 'createProject'" (submit)="createProject()">
			<div class="card card--second-half padding-all__24px margin-top__24px">
				<div class="input">
					<label for="project-name">
						Project name
						<span class="bg__grey__light rounded__4px padding-x__4px position__absolute position--right__0px font__10px font__weight-400">required</span>
					</label>
					<input
						type="text"
						id="project-name"
						placeholder="Enter project name here"
						formControlName="name"
						[ngClass]="{ invalid: projectForm.controls['name'].touched && projectForm.controls['name'].invalid }"
					/>
					<div class="input__error input__error__danger" *ngIf="projectForm.controls['name'].touched && projectForm.controls['name'].invalid">
						<img src="assets/img/input-error-icon.svg" alt="input error icon" />
						<span>Enter new project name</span>
					</div>
				</div>

				<h3 class="margin-top__24px margin-bottom__16px">Project type</h3>
				<div class="project-types grid grid__col-2 grid--gap__24px">
					<div class="project-type checkbox-option">
						<input type="radio" id="incoming" name="type" formControlName="type" value="incoming" />
						<label for="incoming" class="border__all padding-all__16px rounded__4px display__block animate">
							<div class="flex flex__align-items-center margin-bottom__8px">
								<div class="checkbox rounded__50px margin-bottom__0px border__all width__16px height__16px animate"></div>
								<p class="font__14px font__weight-600 margin-left__8px">Incoming webhooks</p>
							</div>
							<p class="color__grey font__12px font__weight-400">Create an incoming webhooks project to proxy events from third-party providers to your endpoints</p>
						</label>
					</div>

					<div class="project-type checkbox-option">
						<input type="radio" id="outgoing" name="type" formControlName="type" value="outgoing" />
						<label for="outgoing" class="border__all padding-all__16px rounded__4px display__block animate">
							<div class="flex flex__align-items-center margin-bottom__8px">
								<div class="checkbox rounded__50px margin-bottom__0px border__all width__16px height__16px animate"></div>
								<p class="font__14px font__weight-600 margin-left__8px">Outgoing webhook</p>
							</div>
							<p class="color__grey font__12px font__weight-400">Create an outgoing webhooks project to publish events to your customer-provided endpoints</p>
						</label>
					</div>
				</div>

				<div formGroupName="config">
					<h3 class="margin-top__24px margin-bottom__16px flex flex__align-items-center">
						Signature Details
						<app-tooltip [size]="'small'" position="right" class="margin-left__4px">This specifies your header and hash function for your project</app-tooltip>
					</h3>
					<div class="grid grid__col-2 grid--gap__24px" formGroupName="signature">
						<div class="input">
							<label for="header">
								Header
								<span class="bg__grey__light rounded__4px padding-x__4px position__absolute position--right__0px font__10px font__weight-400">required</span>
							</label>
							<input
								type="text"
								id="header"
								placeholder="X-Convoy-Signature"
								formControlName="header"
								[ngClass]="{ invalid: projectForm.get('config.signature.header')?.touched && projectForm.get('config.signature.header')?.invalid }"
							/>
							<div class="input__error input__error__danger" *ngIf="projectForm.get('config.signature.header')?.touched && projectForm.get('config.signature.header')?.invalid">
								<img src="assets/img/input-error-icon.svg" alt="input error icon" />
								<span>Enter header for project requests</span>
							</div>
						</div>

						<div class="input">
							<label for="hash">
								Hash
								<span class="bg__grey__light rounded__4px padding-x__4px position__absolute position--right__0px font__10px font__weight-400">required</span>
							</label>
							<select name="hash" id="hash" formControlName="hash" [ngClass]="{ invalid: projectForm.get('config.signature.hash')?.touched && projectForm.get('config.signature.hash')?.invalid }">
								<option *ngFor="let hash of hashAlgorithms" [value]="hash">{{ hash }}</option>
							</select>
							<div class="input__error input__error__danger" *ngIf="projectForm.get('config.signature.hash')?.touched && projectForm.get('config.signature.hash')?.invalid">
								<img src="assets/img/input-error-icon.svg" alt="input error icon" />
								<span>Please select a hash</span>
							</div>
						</div>
					</div>
					<h3 class="margin-top__24px margin-bottom__16px flex flex__align-items-center">
						Retry Logic
						<app-tooltip [size]="'small'" position="right" class="margin-left__4px">
							These are the specifications for the retry mechanism for your endpoints. In Linear time retry, event retries are done in linear time, while in Exponential back off retry, events are
							retried progressively increasing the time before the next retry attempt.
						</app-tooltip>
					</h3>
					<div class="grid grid__col-2 grid--gap__24px" formGroupName="strategy">
						<div class="input">
							<label for="type">
								Mechanism
								<span class="bg__grey__light rounded__4px padding-x__4px position__absolute position--right__0px font__10px font__weight-400">required</span>
							</label>
							<select name="type" id="type" formControlName="type" [ngClass]="{ invalid: projectForm.get('config.strategy.type')?.touched && projectForm.get('config.strategy.type')?.invalid }">
								<option *ngFor="let type of retryLogicTypes" [value]="type.id">{{ type.type }}</option>
							</select>
							<div class="input__error input__error__danger" *ngIf="projectForm.get('config.strategy.type')?.touched && projectForm.get('config.strategy.type')?.invalid">
								<img src="assets/img/input-error-icon.svg" alt="input error icon" />
								<span>Please select a retry logic mechanism</span>
							</div>
						</div>

						<div class="input">
							<label for="retry-logic-duration">
								Duration
								<span class="bg__grey__light rounded__4px padding-x__4px position__absolute position--right__0px font__10px font__weight-400">required</span>
							</label>
							<input
								type="text"
								id="retry-logic-duration"
								placeholder="e.g 3s"
								formControlName="duration"
								[ngClass]="{ invalid: projectForm.get('config.strategy.duration')?.touched && projectForm.get('config.strategy.duration')?.invalid }"
							/>

							<div class="input__error input__error__danger" *ngIf="projectForm.get('config.strategy.duration')?.touched && projectForm.get('config.strategy.duration')?.invalid">
								<img src="assets/img/input-error-icon.svg" alt="input error icon" />
								<span>Please enter your retry logic duration</span>
							</div>
						</div>

						<div class="input">
							<label for="retry-logic-count">
								Limit
								<span class="bg__grey__light rounded__4px padding-x__4px position__absolute position--right__0px font__10px font__weight-400">required</span>
							</label>
							<input
								type="number"
								id="retry-logic-count"
								placeholder="e.g 5"
								formControlName="retry_count"
								[ngClass]="{ invalid: projectForm.get('config.strategy.retry_count')?.touched && projectForm.get('config.strategy.retry_count')?.invalid }"
							/>

							<div class="input__error input__error__danger" *ngIf="projectForm.get('config.strategy.retry_count')?.touched && projectForm.get('config.strategy.retry_count')?.invalid">
								<img src="assets/img/input-error-icon.svg" alt="input error icon" />
								<span>Please enter a retry limit</span>
							</div>
						</div>
					</div>
					<h3 class="margin-top__24px margin-bottom__16px flex flex__align-items-center">
						Rate Limit Parameters
						<app-tooltip [size]="'small'" position="right" class="margin-left__4px">These are the specifications for how many events are to be sent to an endpoint per time</app-tooltip>
					</h3>
					<div class="grid grid__col-2 grid--gap__24px" formGroupName="rateLimit">
						<div class="input">
							<label for="rate-limit-duration">
								Duration
								<span class="bg__grey__light rounded__4px padding-x__4px position__absolute position--right__0px font__10px font__weight-400">required</span>
							</label>
							<input
								type="text"
								id="rate-limit-duration"
								placeholder="e.g 1m"
								formControlName="duration"
								[ngClass]="{ invalid: projectForm.get('config.rateLimit.duration')?.touched && projectForm.get('config.rateLimit.duration')?.invalid }"
							/>
							<div class="input__error input__error__danger" *ngIf="projectForm.get('config.rateLimit.duration')?.touched && projectForm.get('config.rateLimit.duration')?.invalid">
								<img src="assets/img/input-error-icon.svg" alt="input error icon" />
								<span>Please enter your rate limit duration</span>
							</div>
						</div>
						<div class="input">
							<label for="rate-limit-count">
								Limit
								<span class="bg__grey__light rounded__4px padding-x__4px position__absolute position--right__0px font__10px font__weight-400">required</span>
							</label>
							<input
								type="number"
								id="rate-limit-count"
								placeholder="e.g 5000"
								formControlName="count"
								[ngClass]="{ invalid: projectForm.get('config.rateLimit.count')?.touched && projectForm.get('config.rateLimit.count')?.invalid }"
							/>
							<div class="input__error input__error__danger" *ngIf="projectForm.get('config.rateLimit.count')?.touched && projectForm.get('config.rateLimit.count')?.invalid">
								<img src="assets/img/input-error-icon.svg" alt="input error icon" />
								<span>Please enter a rate limit</span>
							</div>
						</div>
					</div>
				</div>

				<h3 class="margin-top__24px margin-bottom__16px">Disable Failing Endpoints</h3>
				<div class="project-types grid grid__col-2 grid--gap__24px">
					<div class="project-type checkbox-option">
						<input type="radio" id="true" name="disable_endpoint" [value]="true" formControlName="disable_endpoint" />
						<label for="true" class="border__all padding-all__16px rounded__4px display__block animate">
							<div class="flex flex__align-items-center">
								<div class="checkbox rounded__50px margin-bottom__0px border__all width__16px height__16px animate"></div>
								<p class="font__14px font__weight-600 margin-left__8px">True</p>
							</div>
							<p class="color__grey font__12px font__weight-400">Endpoints would be disabled automatically when they are failing.</p>
						</label>
					</div>

					<div class="project-type checkbox-option">
						<input type="radio" id="false" name="disable_endpoint" [value]="false" formControlName="disable_endpoint" />
						<label for="false" class="border__all padding-all__16px rounded__4px display__block animate">
							<div class="flex flex__align-items-center">
								<div class="checkbox rounded__50px margin-bottom__0px border__all width__16px height__16px animate"></div>
								<p class="font__14px font__weight-600 margin-left__8px">False</p>
							</div>
							<p class="color__grey font__12px font__weight-400">Endpoints are not automatically disabled when they are failing.</p>
						</label>
					</div>
				</div>
			</div>

			<div class="button-container flex flex__justify-end margin-top__32px">
				<button routerLink="/" class="button button__white padding-y__12px padding-x__28px rounded__8px margin-right__16px" type="button">Cancel</button>

				<button class="button button__primary button--has-icon padding-y__12px padding-x__28px rounded__8px" [disabled]="isCreatingProject">
					Create Project
					<svg width="24" height="24" class="margin-left__8px" fill="#FCFCFC">
						<use xlink:href="#arrow-right-icon"></use>
					</svg>
				</button>
			</div>
		</form>

		<div class="card padding-all__24px margin-bottom__24px" *ngIf="projectStage !== 'createProject'">
			<ul class="setup-steps flex flex__align-items-center border__bottom padding-bottom__24px">
				<li class="setup-step--step done" *ngIf="projectType === 'incoming'">
					<div class="line"></div>
					<div class="margin-top__4px flex flex__align-items-center">
						<div class="checkbox margin-all__0px width__16px height__16px border__all rounded__50px"></div>
						<div class="text margin-left__8px font__14px font__weight-500">Create Source</div>
					</div>
				</li>
				<li class="setup-step--step current">
					<div class="line bg__primary"></div>
					<div class="margin-top__4px flex flex__align-items-center">
						<div class="checkbox margin-all__0px width__16px height__16px border__all rounded__50px"></div>
						<div class="text margin-left__8px font__14px font__weight-500">Create Application</div>
					</div>
				</li>
				<li class="setup-step--step">
					<div class="line bg__primary"></div>
					<div class="margin-top__4px flex flex__align-items-center">
						<div class="checkbox margin-all__0px width__16px height__16px border__all rounded__50px"></div>
						<div class="text margin-left__8px font__14px font__weight-500">Create Subscription</div>
					</div>
				</li>
			</ul>

			<div *ngIf="projectStage === 'createSource'">
				<h3 class="margin-top__24px font__weight-600 font__18px">Create your first source</h3>
				<p class="font__14px color__grey margin-top__8px width__80">
					Your source represents the etiam diam mi, egestas tortor nulla quis consectetur mauris eget. Penatibus placerat massa, lectus lectus
				</p>
			</div>
			<div *ngIf="projectStage === 'createApplication'">
				<h3 class="margin-top__24px font__weight-600 font__18px">Create your first application</h3>
				<p class="font__14px color__grey margin-top__8px width__80">
					Your source represents the etiam diam mi, egestas tortor nulla quis consectetur mauris eget. Penatibus placerat massa, lectus lectus
				</p>
			</div>
		</div>

		<app-create-source *ngIf="projectStage === 'createSource'"></app-create-source>

		<app-create-app *ngIf="projectStage === 'createApplication'" (discardApp)="cancel()" (createApp)="projectStage = 'createSubscription'"></app-create-app>
	</div>
</div>
